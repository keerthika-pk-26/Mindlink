<!DOCTYPE html>
<html lang="en">
<head>
<a href="dashboard.html" class="home-btn">üè† Home</a>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Level 5 ‚Äì Art Therapy Canvas</title>

<style>
body {
  margin: 0;
  font-family: "Poppins", sans-serif;
  background: linear-gradient(180deg, #a8d8ff, #dff6ff, #ffffff);
  min-height: 100vh;
  text-align: center;
  padding-top: 40px;
  position: relative;
}
.bubble {
  position: fixed;
  bottom: -100px;
  background: rgba(255,255,255,0.55);
  border-radius: 50%;
  animation: floatUp linear infinite;
  z-index: -1;
}
.home-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 10px 15px;
  background: linear-gradient(135deg, #5f5fff, #7f00ff);
  color: white;
  border-radius: 12px;
  text-decoration: none;
  font-weight: 600;
  transition: all 0.3s ease;
  z-index: 1000;
}
.home-btn:hover {
  transform: scale(1.05);
  background: linear-gradient(135deg, #6a5eff, #7e22ce);
}
@keyframes floatUp {
  0% { transform: translateY(0) scale(1); opacity: 1;}
  100% { transform: translateY(-120vh) scale(1.3); opacity: 0;}
}
.canvas-container {
  width: 90%;
  max-width: 900px;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 20px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.15);
}
#drawArea {
  border: 2px solid #ccc;
  border-radius: 12px;
  background: white;
  display: block;
  margin: 0 auto;
  cursor: crosshair;
}
.tools {margin-top:15px; display:flex; justify-content:center; flex-wrap:wrap; gap:15px;}
.color {width:32px; height:32px; border-radius:50%; cursor:pointer; border:2px solid #666;}
button {padding:8px 15px; border-radius:10px; background:#00b894; color:white; border:none; cursor:pointer;}
button:hover {background:#019872;}
.template-box {margin-top:20px;}
.template-box img {width:120px; height:120px; margin:10px; border-radius:12px; cursor:pointer; border:3px solid transparent;}
.template-box img:hover {border:3px solid #0077ff;}
</style>
</head>

<body>

<h1>üé® Level 5 ‚Äì Art Therapy Canvas</h1>
<p>Draw freely or fill mandalas with colors!</p>

<div class="canvas-container">
  <canvas id="drawArea" width="800" height="650"></canvas>

  <div class="tools">
    <div>
      <strong>Colors:</strong><br>
      <div style="display:flex; gap:10px; margin-top:6px;">
        <div class="color" style="background:red" onclick="changeColor('red')"></div>
        <div class="color" style="background:blue" onclick="changeColor('blue')"></div>
        <div class="color" style="background:green" onclick="changeColor('green')"></div>
        <div class="color" style="background:orange" onclick="changeColor('orange')"></div>
        <div class="color" style="background:purple" onclick="changeColor('purple')"></div>
        <div class="color" style="background:black" onclick="changeColor('black')"></div>
        <div class="color" style="background:pink" onclick="changeColor('pink')"></div>
        <div class="color" style="background:yellow" onclick="changeColor('yellow')"></div>
        <div class="color" style="background:brown" onclick="changeColor('brown')"></div>
        <div class="color" style="background:cyan" onclick="changeColor('cyan')"></div>
      </div>
    </div>

    <button onclick="enableEraser()">Eraser</button>
    <button onclick="clearCanvas()">Clear</button>
    <button onclick="undoCanvas()">Undo</button>
    <button onclick="toggleMusic()" id="musicBtn">üéµ Play Music</button>
  </div>

  <h3 style="margin-top:30px;">Choose a Mandala Template</h3>
  <div class="template-box">
    <img src="mandala2.png.jpeg" onclick="loadTemplate('mandala2.png.jpeg')">
    <img src="mandala3.png.png" onclick="loadTemplate('mandala3.png.png')">
    <img src="mandala4.png.jpeg" onclick="loadTemplate('mandala4.png.jpeg')">
  </div>
</div>

<audio id="bgMusic" loop>
  <source src="piano.mp3" type="audio/mp3">
</audio>

<script>
// Floating bubbles
for(let i=0;i<20;i++){
  let b=document.createElement("div");
  let size=Math.random()*40+20;
  b.classList.add("bubble");
  b.style.width=size+"px";
  b.style.height=size+"px";
  b.style.left=Math.random()*100+"vw";
  b.style.animationDuration=8+Math.random()*6+"s";
  document.body.appendChild(b);
}

// Canvas logic
const canvas=document.getElementById("drawArea");
const ctx=canvas.getContext("2d");
let brushColor='black';
let drawing=false;
let mandalaLoaded=false;
let history=[];

// Free brush drawing
canvas.addEventListener('mousedown',()=>{drawing=true; saveHistory();});
canvas.addEventListener('mouseup',()=>{drawing=false; ctx.beginPath();});
canvas.addEventListener('mouseleave',()=>{drawing=false; ctx.beginPath();});
canvas.addEventListener('mousemove',(e)=>{
  if(!drawing || mandalaLoaded) return; // only brush if not mandala click
  ctx.strokeStyle=brushColor;
  ctx.lineWidth=8;
  ctx.lineCap='round';
  ctx.lineJoin='round';
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(e.offsetX,e.offsetY);
});

// Fill mandala on click
canvas.addEventListener('click',(e)=>{
  if(!mandalaLoaded) return;
  const x=e.offsetX;
  const y=e.offsetY;
  floodFill(x,y,hexToRgb(brushColor));
  saveHistory();
});

function changeColor(c){brushColor=c;}
function enableEraser(){brushColor='white';}
function clearCanvas(){ctx.clearRect(0,0,canvas.width,canvas.height); history=[]; mandalaLoaded=false;}

// Load mandala template
function loadTemplate(imgPath){
  let img=new Image();
  img.src=imgPath;
  img.onload=()=>{
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.globalAlpha=0.3;
    ctx.drawImage(img,0,0,canvas.width,canvas.height);
    ctx.globalAlpha=1;
    mandalaLoaded=true;
    saveHistory();
  }
}

// Undo feature
function saveHistory(){
  history.push(ctx.getImageData(0,0,canvas.width,canvas.height));
  if(history.length>20) history.shift();
}
function undoCanvas(){
  if(history.length>1){
    history.pop();
    ctx.putImageData(history[history.length-1],0,0);
  }
}

// Simple flood fill for mandala
function floodFill(startX,startY,fillColor){
  const imgData=ctx.getImageData(0,0,canvas.width,canvas.height);
  const data=imgData.data;
  const width=imgData.width;
  const height=imgData.height;
  const stack=[[startX,startY]];
  const startPos=(startY*width+startX)*4;
  const targetColor=[data[startPos],data[startPos+1],data[startPos+2],data[startPos+3]];
  if(arrEqual(targetColor,fillColor)) return;
  while(stack.length>0){
    const [x,y]=stack.pop();
    if(x<0||x>=width||y<0||y>=height) continue;
    let pos=(y*width+x)*4;
    if(!arrEqual([data[pos],data[pos+1],data[pos+2],data[pos+3]],targetColor)) continue;
    data[pos]=fillColor[0];
    data[pos+1]=fillColor[1];
    data[pos+2]=fillColor[2];
    data[pos+3]=255;
    stack.push([x+1,y],[x-1,y],[x,y+1],[x,y-1]);
  }
  ctx.putImageData(imgData,0,0);
}
function arrEqual(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2];}

function hexToRgb(colorName){
  const colors={red:[255,0,0],blue:[0,0,255],green:[0,128,0],orange:[255,165,0],purple:[128,0,128],
    black:[0,0,0],pink:[255,192,203],yellow:[255,255,0],brown:[165,42,42],cyan:[0,255,255]};
  return colors[colorName]||[0,0,0];
}

// Music toggle
const bgMusic=document.getElementById("bgMusic");
const musicBtn=document.getElementById("musicBtn");
function toggleMusic(){
  if(bgMusic.paused){bgMusic.play(); musicBtn.innerText="üéµ Pause Music";}
  else{bgMusic.pause(); musicBtn.innerText="üéµ Play Music";}
}

</script>


</body>
</html>
